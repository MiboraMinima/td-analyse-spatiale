# Introduction √† R et RStudio

Comme dans la majorit√© des langages interpr√©t√©s, quand on installe `R`, une
[console
interactive](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop)
est install√©e en m√™me temps. Vous pouvez y acc√©der en cherchant R dans vos
programmes ou en effectuant les op√©rations `ctrl+R` (ouvrir l'ex√©cuteur de
commmande) > `R` > `enter`. C'est comme quand vous ouvrez un terminal
`powershell` sous Windows, sauf qu'au lieu d'√©crire du `powershell`, vous
√©crivez du `R`.

Dans l'absolu, on pourrait √©crire nos scripts dans la console directement mais
ce serait tr√®s peu pratique. Aussi, quand on code, on utilise un **Environnement
de D√©veloppement** (*IDE* en Anglais), et ce, quelque soit le langage que l'on
utilise. Ces derniers int√®grent des tas de fonctionnalit√©s pour vous simplifier
la vie (colorisation du code, diagnostique automatique des erreurs de syntaxe,
outils int√©gr√©s de visualisation, etc.). Il y en a beaucoup. Certains sont
g√©n√©riques (ils supportent de nombreux langages) comme [Visual Studio
Code](https://code.visualstudio.com/) ou sp√©cifique, destin√© √† un seul langage,
comme c'est le cas de [RStudio](https://posit.co/download/rstudio-desktop/) pour
`R`.

## RStudio

Il s'agit de l'IDE le plus utilis√© pour faire du `R`, et de tr√®s tr√®s loin. Il
est *open-source* et fr√©quemment mis √† jour.

### Cr√©ation d'un projet

#### Organiser son dossier de travail {#sec-orga-files}

La premi√®re chose √† faire quand on commence un projet, quelqu'il soit, c'est de
se **cr√©er un espace de travail coh√©rent** ou vous vous retrouverez facilement.
Ce dernier doit √™tre le plus g√©n√©ralisable possible, de telle sorte √† ce que
vous puissier le r√©employer pour d'autres projets. De cette fa√ßon, vous ne serez
plus jamais perdus dans vos fichiers et vous **gagnerez un temps consid√©rable**.
Pour de l'analyse/traitement de donn√©es, je vous conseil la configuration
suivante :

- üìÅ `./data/`: l√† o√π vous stockerez vos donn√©es
    - üìÅ `./data/src/`: Les donn√©es sources
    - üìÅ `./data/res/`: Les donn√©es cr√©√©es par vos scripts
- üìÅ `./docs/`: l√† o√π vous enregistrerez vos documents words par exemple.
- üìÅ `./figures/`: l√† o√π vous enregistrerez vos graphs, cartes, ect.
- üìÅ `./scripts/`: vos scripts R

Le `./` fait r√©f√©rence √† la **racine** du dossier : le chemin du dossier dans
lequel les dossiers ci-dessus sont enregistr√©s. Cette racine peut √™tre situ√©e o√π
vous le souhaitez sur votre machine.

:::{.callout-important title="Bien nommer ses fichiers"}

Pourquoi est-ce important ?

- Pour ne pas vous demander √† chaque fois pendant trois plombes √† comment vous
allez √©crire un nom de fichier ou de dossier.
- Encore une fois pour avoir une organisation nickel.
- Pour √©viter de vous retrouver avec des erreurs li√©s √† des espaces ou des
caract√®res sp√©ciaux.

Aussi, je vous conseil d'adopter une **convention d'√©criture**. Il y en a plein,
vous pouvez inventer la votre tant qu'elle est coh√©rente. Il est notamment
important de proscrire tous les signes diacritiques (√©, √®, √ß, √†, etc.), les
espaces et les signes (/, %, $, etc.). Je vous conseil la convention qui
consiste √† n'√©crire qu'en miniscule, sans caract√®res sp√©ciaux et en repla√ßant les
espaces par des underscores (`_`).

Par exemple :

:::::::::::::: {.columns}
::: {.column width="50%"}
**Bien**
```
td0_introduction_r.R
rendu_20250506_analyse_spatiale.R
graph_epervier.png
```
:::

::: {.column width="50%"}
**Naze**
```
TD 0 Introduction √† R .R
Rendu_2025/05/06_AnalyseSpatiale.R
Graphique √©pervier.png
```
:::
::::::::::::::
:::

#### Cr√©er un projet RStudio

Une fois que vous avez cr√©√© votre espace de travail dans votre explorateur de
fichier, proc√©dez aux op√©rations suivantes pour cr√©er un projet RStudio.

::: {.callout-tip title="Instructions"}
1. Ouvrez RStudio
2. Cr√©ez un nouveau projet: `Fichier` > `Nouveau projet` > `R√©pertoire existant`.
Indiquez le dossier que vous avez cr√©√© pr√©c√©demment.
3. Cr√©ez un nouveau script `R` : `Fichier` > `Nouveau fichier` > `Script R`.
   Enregistrez le (`ctrl+s`).
:::

### L'interface

![Interface de RStudio](figures/rstud_interface.png){#fig-rstud_inter}

L'interface fonctionne avec des panneaux que l'on peut changer au besoin dans
les pr√©f√©rences du logiciel[^0_rstud_panes]. Par d√©faut, on a l'organisation de la
@fig-rstud_inter.

[^0_rstud_panes]: `Affichage`>`Volet`>`Options de mise en page des volets`

- **A)**:
    - Dans ce panneau, vous avez vos scripts `R`. **C'est ici que vous
    √©crirez.**
- **B)**:
    - `Console`: La console `R`. La m√™me console int√©ractive que quand on ouvre
    `R` sans RStudio.
    - `Terminal`: Le terminal de votre machine. Sous Windows du `???`.
    - `Travaux`: Des *jobs* que vous faites tourner en arri√®re-plan.
- **C)**:
    - `Environnement`: La liste des objets de la session courante.
    - `Historique`: L'historique des commandes introduites dans la console `R`.
    - `Connexions`: Connexions √† des bases de donn√©es externes.
    - `Tutoriel`: tutos
- **D)**:
    - `Fichiers`: Un explorateur de fichier (comme l'explorateur de fichier windows)
    - `Graphiques`: Un espace o√π les graphs seront affich√©s.
    - `Paquets`: Liste de packages, vous pouvez les installer depuis cet
    onglet.
    - `Aide`: Onglet o√π sont affich√©s les documentations des fonctions que vous
    utilisez.
    - `Visualisateur`: Onglet d'affichage des graphs 3D, des pages webs, etc.
    - `Pr√©sentation`: Onglet d√©di√© aux pr√©sentations.

Il existe d'autres panneaux que l'on peut rajouter √† l'interface au besoin. Vous
aurez surtout besoin de la console, de l'environnement, de l'onglet graphique et
aide.

## Qu'est-ce qu'y fait ? Y relance de 5 ?

Pour comprendre les bases de R et la programmation de mani√®re g√©n√©rale, simulons
une bonne grosse partie de roulette fran√ßaise des famllies entre Bach, Taylor
Swift et Charlie Parker.

### Cr√©ation des joueurs

Pour qu'il y ait jeu, il faut qu'il y ai des joueurs. Donc on commence par cr√©er
nos b√©lig√©rants. Pour cela, on cr√©e un objet de type `list` pour chacun d'eux en
leur attribuant un p√©cule √©galement sous forme de `list`.

```{r}
gaziers <- list(
    "Taylor Swift" = list("argent" = 30),
    "Bach" = list("argent" = 10),
    "Charlie Parker" = list("argent" = 5)
)
```

:::{.callout-note appearance="simple" title="Explications"}
Pour assigner une valeur sous `R`, on utilise `<-` (ou `=`, mais ce n'est pas la
convention).

On peut afficher la liste avec la fonction `print()` ou simplement en entrant le
nom de la liste.

```{r}
print(gaziers)
```

La liste cr√©√©e est dite "nomm√©e" car chaque item poss√®de un nom (par-ex. "Taylor
Swift" ou "argent"). On peut retrouver les noms en utilisant la fonction
`names()`.

```{r}
names(gaziers)
```

Pour acc√©der aux diff√©rents items de la liste, on peut utiliser soit le `$` soit
les `[[]]` avec le nom des joueurs.

```{r}
gaziers$Bach
gaziers$Bach$argent

gaziers[["Bach"]]
gaziers[["Bach"]][["argent"]]
```
:::

### Un tour en roulette fran√ßaise

Ensuite, on d√©finit les r√®gles du jeu. On utilise une version simplifi√©e de la
roulette fran√ßaise o√π, √† chaque tour, chacun des joueurs mise sur un chiffre
entre 0 et 36 et si le num√©ro qui sort est de la m√™me parit√© (pair ou impair)
que le num√©ro sur lequel ils ont mis√©, alors leur mise est doubl√©e, sinon ils
perdent leur mise.

Pour commencer, fixons la mise minimale et maximale.

```{r}
# mise minimale
MISE_MIN <- 1
# mise maximale
MISE_MAX <- 10
```

:::{.callout-note appearance="simple" title="Explications"}
De nouveau, on utilise le `<-` pour assigner des valeurs √† des objets. Les
lignes commen√ßant par `#` sont **des commentaires**. Ils sont extr√™ments
importants car ils vous permettent d'√©crire librement du texte dans un script
sans qu'il soit interpr√©t√© comme du code. Vous pouvez ainsi **documenter** votre
code pour faciliter sa lecture par ceux qui le liront.
:::

Il nous faut maintenant d√©finir en quoi consiste un tour de notre roulette
fran√ßaise. Dans un premier temps, les joueurs misent et parient en fonction de
l'argent disponible. Par exemple, pour "Bach" :

```{r}
# On r√©cup√®re l'argent que poss√®de Bach
nom <- "Bach"
argent <- gaziers[[nom]][["argent"]]

# Sauter le joueur s‚Äôil n‚Äôa plus d‚Äôargent
if (argent < MISE_MIN) {
    # On indique √† l'utilisateur que le joueur `nom` n'a plus d'argent
    cat(nom, "n‚Äôa plus d‚Äôargent et ne peut pas jouer.\n")
} else {
    # Le joueur choisit un pari et une mise
    pari <- sample(c("pair", "impair"), 1)
    mise <- min(sample(MISE_MIN:MISE_MAX, 1), argent)

    # On print le pari et la mise pour le joueur courant
    cat(nom, "parie", mise, "‚Ç¨ sur", pari, "\n")
}
```

:::{.callout-note appearance="simple" title="Explications"}
Beaucoup de nouvelles choses de ce code. Les deux premi√®res lignes exploitent la
liste `gaziers` pour r√©cup√©rer l'argent dont Bach dispose comme vu pr√©c√©demment.
Ensuite, on test si le joueur dispose d'une quantit√© d'argent suffisante pour
jouer. Pour cela, on utilise une **structure de contr√¥le** de type alternative
en `IF/ELSE` (SI/SINON). Il s'agit d'une des op√©rations les plus courante en
**algorithmique**. Il s'agit d'effectuer une op√©ration si (IF) une condition est
satisfaite ou d'en faire une autre sinon (ELSE). En l'occurence, si la somme
d'argent est strictement inf√©rieure √† la mise minimum d√©finie plus haut
(`MISE_MIN`), alors on indique √† l'utilisateur que le joueur `nom` (Bach ici)
n'a plus assez d'argent pour jouer et on ne fait rien. Sinon, on choisit
al√©atoirement le pari (pair ou impair) au moyen de la **fonction** `sample()`.
La mise est √©galement choisie al√©atoirement dans un interval d√©fini par la mise
minimale et la mise maximale (`MISE_MIN:MISE_MAX`) ; on utilise une combinaison
de la fonction `sample()` et `min()`. Les fonctions sont omnipr√©sentes en
programmation. √Ä partir d'**arguments** (ce qui se trouve entre parenth√®se)
elles ex√©cutent du code "pr√©-enregistr√©". On peut utiliser des fonctions
pr√©-construites comme c'est le cas de la fonction `sample()` ou des fonctions
que l'on aura d√©finie soit-m√™me. Vous pouvez trouver une description des
fonctions sous `R` en rentrant un point d'interogation devant le nom de la
fonction dans la console : `?sample`.

Regardons dans le d√©tail ce qui se passe pour la ligne qui d√©finie la mise. Pour
d√©finir l'interval dans lequel on choisira la mise, on utilise l'op√©rateur de
s√©quence `:`. √Ä partir de deux valeurs num√©riques, il construit une s√©quence
allant du premier au deuxi√®me de un en un.

```{r}
print(2:5)
print(MISE_MIN:MISE_MAX)
```

L'objet qui est retourn√© est un **vecteur** : un ensemble de valeurs du m√™me
type. Un vecteur est d√©fini manuellement via la fonction `c()` (*combine*).

```{r}
# Vecteur de type numeric
vector_num <- c(1, 2, 4, 5, 6)
print(vector_num)
print(class(vector_num))

# Vecteur de type character
vector_str <- c("Pair", "Impair")
print(vector_str)
print(class(vector_str))
```

Une √† partir de l'interval, la fonction `sample()` choisi une valeur
al√©atoirement dans le vecteur. Le probl√®me c'est que la somme choisie peut √™tre
sup√©rieure √† l'argent dont le joueur dispose. Dans ce cadre, on utilise une la
fonction `min()` (pour *minimum*) pour retenir l'argent total dont dispose le
joueur si la mise al√©atoirement choisie lui est sup√©rieure.

```{r}
# Exemple pour une mise sup√©rieure √† l'argent dont dispose le joueur
mise_aleatoire <- sample(3:10, 1)
argent_test <- 2
min(mise_aleatoire, argent_test)
```

Notez que l'on peut mettre une fonction √† l'int√©rieur d'une autre. Cela permet
de simplifier l'√©criture.

```{r}
# Cela revient au m√™me que de faire
min(sample(3:10, 1), argent_test)
```
:::

Il nous effectuer cette op√©ration de mise et pari pour nos trois joueurs. On
pourrait r√©√©crire le code trois fois en changeant le nom des variables pour
chaque joueur mais ce serait tr√®s fastidieux. Aussi, on va tirer parti d'une
autre **structure de contr√¥le** qui permet de r√©p√©ter des op√©rations : une
**boucle** (*loop*). Une boucle dit : POUR CHAQUE √©l√©ment DANS un ensemble :
FAIT une op√©ration impliquant l'√©l√©ment. On √©crit, en pseudo code :

```
POUR CHAQUE element DANS emsemble:
FAIT
    operation(element)
FIN
```

Par exemple :

```
fruits = (pomme, banane, mandarine)
POUR CHAQUE fruit DANS fruits:
FAIT
    affiche(fruit)
FIN
```

Sous `R`, on √©crira :

```{r}
fruits <- c("pomme", "banane", "mandarine")
for (fruit in fruits) {
    cat(fruit, "\n")
}
```

Dans notre exemple, on a :

```
POUR CHAQUE joueur DANS gaziers:
FAIT
    mise et pari
FIN
```

Aussi, on r√©√©crit notre de code de mise et pari de la fa√ßon suivante :

```{r}
# Chaque joueur joue
pari_mise <- list()
for (joueur in names(gaziers)) {
    # On r√©cup√®re l'argent dont dispose le joueur
    argent <- gaziers[[joueur]][["argent"]]

    # Sauter le joueur s‚Äôil n‚Äôa plus d‚Äôargent
    if (argent < MISE_MIN) {
        cat(joueur, "n‚Äôa plus d‚Äôargent et ne peut pas jouer.\n")
        next
    }

    # Le joueur choisit un pari et une mise
    pari <- sample(c("pair", "impair"), 1)
    mise <- min(sample(MISE_MIN:MISE_MAX, 1), argent)

    # On print le pari et la mise pour le joueur courant
    cat(joueur, "parie", mise, "‚Ç¨ sur", pari, "\n")

    # On enregistre le pari et la mise dans la liste
    pari_mise[[joueur]][["pari"]] <- pari
    pari_mise[[joueur]][["mise"]] <- mise
}
```

:::{.callout-note appearance="simple" title="Explications"}
Dans un premier temps, on a **instantie** une liste vide `pari_mise` qui
permettra d'enregistrer les mises et paries et de chaque joueur.

Ensuite, on construit la boucle. Pour chaque joueur, on r√©cup√®re l'argent
correspondant et on r√©√©crit le code pr√©c√©dent. On change le IF/ELSE en disant
que si la le joueur n'as pas assez d'argent pour jouer, alors, on arr√™te la
boucle √† cet endroit pour ce joueur et on passe directement au prochain. Pour
cela on utilise le mot cl√© `next`. √Ä la fin de la boucle, on enregistre les
paris et les mises dans la liste instanti√©e avant la boucle.
:::

On peut simplifier l'√©criture en construisant une **fonction** pour notre
op√©ration de mise et parie. Cela va nous permettre d'√©purer le code et
d'augmenter sa **modularit√©**. En `R`, pour constuire une fonction, on utilise
la syntaxe suivante :

```{r}
my_fun <- function(arg1, arg2, type = "somme") {
    # Corps de la fonction
    if (type == "somme") {
        resultat <- arg1 + arg2
    } else if (type == "difference") {
        resultat <- arg1 - arg2
    } else {
        stop(type, " est une op√©ration inconnue")
    }
    return(resultat)
}
my_fun(1, 2, type = "difference")
```

Les arguments que prendrons la fonction sont donn√©es entre parenth√®ses. Si on
assigne une valeur √† un des arguments alors il n'est pas obligatoire et poss√®de
une valeur par d√©faut.

Pour notre fonction de mise et pari on peut √©crire :

```{r}
mise_pari <- function(argent, mise_min, mise_max, nom) {
    # Retourner une valeur NULL si le joueur n'a pas assez d'argent pour jouer
    if (argent < mise_min) {
        cat(nom, "n‚Äôa plus d‚Äôargent et ne peut pas jouer.\n")
        return(NULL)
    } else {
        # Le joueur choisit un pari et une mise
        pari <- sample(c("pair", "impair"), 1)
        mise <- min(sample(mise_min:mise_max, 1), argent)

        # On print le pari et la mise pour le joueur courant
        cat(nom, "parie", mise, "‚Ç¨ sur", pari, "\n")
    }
    return(list(pari = pari, mise = mise))
}
```

On peut alors r√©√©crire notre boucle comme suit :

```{r}
pari_mise <- list()
for (nom in names(gaziers)) {
    argent <- gaziers[[nom]][["argent"]]

    # Effectuer la mise et le parie
    mise_pari_vec <- mise_pari(argent, MISE_MIN, MISE_MAX, nom)

    # Sauter le joueur s‚Äôil n‚Äôa plus d‚Äôargent
    if (is.null(mise_pari_vec)) next

    # Enregistrer les mises et paris
    pari_mise[[nom]][["pari"]] <- mise_pari_vec[["pari"]]
    pari_mise[[nom]][["mise"]] <- mise_pari_vec[["mise"]]
}
```

√Ä ce stade, vous avez tous les √©l√©ments de la programmation basique.

Reprenons le fil de notre simulation. Une fois que les joueurs on pari√©s et
mis√©s, le croupier dit "Rien de va plus !" et la bille s'arr√™te sur le r√©sultat
:

```{r}
# Tirage du num√©ro
cat("\nüé° Rien ne vas plus !")

numero <- sample(0:36, 1)
cat("\nüé° Le num√©ro tir√© est :", numero, "\n")

# D√©terminer la couleur du r√©sultat
if (numero == 0) {
    resultat <- "zero"
} else if (numero %% 2 == 0) {
    resultat <- "pair"
} else {
    resultat <- "impair"
}
```

:::{.callout-note appearance="simple" title="Explications"}
Le numero tir√© est s√©lectionn√© al√©atoirement. √Ä partir de ce num√©ro, on d√©fini
le r√©sultat comme "zero", "pair" ou "impair" au moyen d'un IF/ELSE. L'op√©rateur
`%%` est un [modulo](https://fr.wikipedia.org/wiki/Modulo_(op%C3%A9ration)){target="_blank"}.
:::

Ensuite, on compart les paris des joueurs au r√©sultat et on met √† jour la solde
des joueurs au regard des mises. On peut √©crire une fonction pour cela :

```{r}
verif_pari_mise <- function(pari, mise, resultat, argent, nom) {
    if (resultat == pari) {
      argent_nouv <- argent + mise
      cat("‚úÖ", nom, "gagne", mise, "‚Ç¨ ! Nouveau solde :", argent_nouv, "‚Ç¨\n")
    } else if (resultat == "zero") {
      # si le z√©ro sort, tout le monde perd sa mise
      argent_nouv <- argent - mise
      cat("üíÄ Z√©ro sorti !", nom, "perd", mise, "‚Ç¨ (reste :", argent_nouv, "‚Ç¨)\n")
    } else {
      argent_nouv <- argent - mise
      cat("‚ùå", nom, "perd", mise, "‚Ç¨ (reste :", argent_nouv, "‚Ç¨)\n")
    }
    return(argent_nouv)
}
```

:::{.callout-note appearance="simple" title="Explications"}
La fonction v√©rifie si le resultat correspond au pari. Si c'est le cas, alors la
mise est ajout√©e au solde existant, si le r√©sultat est z√©ro ou que le r√©sultat
ne correspond pas au pari alors le joueur perd sa mise.
:::

De nouveau, on effectue cette op√©ration chaque joueur, on utilise donc une
boucle :

```{r}
for (nom in names(pari_mise)) {
    # On r√©cup√®re le pari, la mise et l'argent
    pari <- pari_mise[[nom]][["pari"]]
    mise <- pari_mise[[nom]][["mise"]]
    argent <- gaziers[[nom]][["argent"]]

    # On calcule le nouveau solde en affichant le r√©sulat avec la fonction
    # d√©finie plus haut
    nouveau_solde <- verif_pari_mise(pari, mise, resultat, argent, nom)

    # On met √† jour le solde
    gaziers[[nom]][["argent"]] <- nouveau_solde
}
```

Voil√†, nous avons fini d'√©crire notre script pour un tour de roulette fran√ßaise
avec nos trois joueurs. √âcrivons une fonction qui encapsule l'ensemble de ce
tour :

```{r}
tour_roulette <- function(joueurs, mise_min, mise_max) {
    cat("\nüé° Faites vos jeux !\n")

    # Chaque joueur joue
    pari_mise <- list()
    for (nom in names(gaziers)) {
        argent <- gaziers[[nom]][["argent"]]

        # Effectuer la mise et le parie
        mise_pari_vec <- mise_pari(argent, mise_min, mise_max, nom)

        # Sauter le joueur s‚Äôil n‚Äôa plus d‚Äôargent
        if (is.null(mise_pari_vec)) next

        pari_mise[[nom]][["pari"]] <- mise_pari_vec[["pari"]]
        pari_mise[[nom]][["mise"]] <- mise_pari_vec[["mise"]]
    }

    # Tirage du num√©ro
    cat("\nüé° Rien ne vas plus !")

    numero <- sample(0:36, 1)
    cat("\nüé° Le num√©ro tir√© est :", numero, "\n")

    # D√©terminer la couleur du r√©sultat
    if (numero == 0) {
        resultat <- "zero"
    } else if (numero %% 2 == 0) {
        resultat <- "pair"
    } else {
        resultat <- "impair"
    }

    for (nom in names(pari_mise)) {
        # On r√©cup√®re le pari, la mise et l'argent
        pari <- pari_mise[[nom]][["pari"]]
        mise <- pari_mise[[nom]][["mise"]]
        argent <- gaziers[[nom]][["argent"]]

        # On calcule le nouveau solde en affichant le r√©sulat avec la fonction
        # d√©finie plus haut
        nouveau_solde <- verif_pari_mise(pari, mise, resultat, argent, nom)

        # On met √† jour le nouveau solde
        gaziers[[nom]][["argent"]] <- nouveau_solde
    }

    return(gaziers)
}
```

### Simuler la partie

Il s'agit maintenant de faire tourner l'ensemble du code pour le nombre de tout
d√©fini au d√©but de notre script (`NB_TOURS`) :

```{r}
NB_TOURS <- 5
for (tour in 1:NB_TOURS) {
  cat("\n================== TOUR", tour, "==================\n")
  gaziers <- tour_roulette(gaziers, MISE_MIN, MISE_MAX)
}
```

On peut alors donner le solde des diff√©ntes joueurs √† la fin de la partie :

```{r}
cat("\nüí∞ R√©sultats finaux :\n")
for (nom in names(gaziers)) {
  cat(nom, ":", gaziers[[nom]][["argent"]], "‚Ç¨\n")
}
```

### Le script complet

Voil√† le script complet

```{r}
#| code-fold: true
#| eval: false

# Initialisation des joueurs
gaziers <- list(
    "Taylor Swift" = list("argent" = 30),
    "Bach" = list("argent" = 10),
    "Charlie Parker" = list("argent" = 5)
)

##############################################################
# FONCTIONS
##############################################################
mise_pari <- function(argent, mise_min, mise_max, nom) {
    # Sauter le joueur s‚Äôil n‚Äôa plus d‚Äôargent
    if (argent < mise_min) {
        cat(nom, "n‚Äôa plus d‚Äôargent et ne peut pas jouer.\n")
        return(NULL)
    } else {
        # Le joueur choisit un pari et une mise
        pari <- sample(c("pair", "impair"), 1)
        mise <- min(sample(mise_min:mise_max, 1), argent)

        # On print le pari et la mise pour le joueur courant
        cat(nom, "parie", mise, "‚Ç¨ sur", pari, "\n")
    }
    return(list(pari = pari, mise = mise))
}

verif_pari_mise <- function(pari, mise, resultat, argent, nom) {
    if (resultat == pari) {
      argent_nouv <- argent + mise
      cat("‚úÖ", nom, "gagne", mise, "‚Ç¨ ! Nouveau solde :", argent_nouv, "‚Ç¨\n")
    } else if (resultat == "zero") {
      # si le z√©ro sort, tout le monde perd sa mise
      argent_nouv <- argent - mise
      cat("üíÄ Z√©ro sorti !", nom, "perd", mise, "‚Ç¨ (reste :", argent_nouv, "‚Ç¨)\n")
    } else {
      argent_nouv <- argent - mise
      cat("‚ùå", nom, "perd", mise, "‚Ç¨ (reste :", argent_nouv, "‚Ç¨)\n")
    }
    return(argent_nouv)
}

tour_roulette <- function(joueurs, mise_min, mise_max) {
    cat("\nüé° Faites vos jeux !\n")

    # Chaque joueur joue
    pari_mise <- list()
    for (nom in names(gaziers)) {
        argent <- gaziers[[nom]][["argent"]]

        # Effectuer la mise et le parie
        mise_pari_vec <- mise_pari(argent, mise_min, mise_max, nom)

        # Sauter le joueur s‚Äôil n‚Äôa plus d‚Äôargent
        if (is.null(mise_pari_vec)) next

        pari_mise[[nom]][["pari"]] <- mise_pari_vec[["pari"]]
        pari_mise[[nom]][["mise"]] <- mise_pari_vec[["mise"]]
    }

    # Tirage du num√©ro
    cat("\nüé° Rien ne vas plus !")

    numero <- sample(0:36, 1)
    cat("\nüé° Le num√©ro tir√© est :", numero, "\n")

    # D√©terminer la couleur du r√©sultat
    if (numero == 0) {
        resultat <- "zero"
    } else if (numero %% 2 == 0) {
        resultat <- "pair"
    } else {
        resultat <- "impair"
    }

    for (nom in names(pari_mise)) {
        # On r√©cup√®re le pari, la mise et l'argent
        pari <- pari_mise[[nom]][["pari"]]
        mise <- pari_mise[[nom]][["mise"]]
        argent <- gaziers[[nom]][["argent"]]

        # On calcule le nouveau solde en affichant le r√©sulat avec la fonction
        # d√©finie plus haut
        nouveau_solde <- verif_pari_mise(pari, mise, resultat, argent, nom)

        # On met √† jour le nouveau solde
        gaziers[[nom]][["argent"]] <- nouveau_solde
    }

    return(gaziers)
}

##############################################################
# PARAM√àTRES DE LA PARTIE
##############################################################
NB_TOURS <- 5        # nombre de tours √† jouer
MISE_MIN <- 1        # mise minimale
MISE_MAX <- 10       # mise maximale
set.seed(42)         # pour des r√©sultats reproductibles

##############################################################
# SIMULATION
##############################################################
for (tour in 1:NB_TOURS) {
  cat("\n================== TOUR", tour, "==================\n")
  gaziers <- tour_roulette(gaziers, MISE_MIN, MISE_MAX)
}

##############################################################
# R√âSULTATS FINAUX
##############################################################
cat("\nüí∞ R√©sultats finaux :\n")
for (nom in names(gaziers)) {
  cat(nom, ":", gaziers[[nom]][["argent"]], "‚Ç¨\n")
}
```


### R√©f√©rences

Cheat sheet :

- [RStudio](https://rstudio.github.io/cheatsheets/rstudio-ide.pdf){target="_blank"}
- [Base R](https://iqss.github.io/dss-workshops/R/Rintro/base-r-cheat-sheet.pdf){target="_blank"}
- [dplyr](https://thinkr.fr/pdf/dplyr-french-cheatsheet.pdf){target="_blank"}


