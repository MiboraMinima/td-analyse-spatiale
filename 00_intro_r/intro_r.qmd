# Introduction √† R et RStudio

Comme dans la majorit√© des langages interpr√©t√©s, quand on installe `R`, une
[console
interactive](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop)
est install√©e en m√™me temps. Vous pouvez y acc√©der en cherchant R dans vos
programmes ou en effectuant les op√©rations `ctrl+R` (ouvrir l'ex√©cuteur de
commmande) > `R` > `enter`. C'est comme quand vous ouvrez un terminal
`powershell` sous Windows, sauf qu'au lieu d'√©crire du `powershell`, vous
√©crivez du `R`.

Dans l'absolu, on pourrait √©crire nos scripts dans la console directement mais
ce serait tr√®s peu pratique. Aussi, quand on code, on utilise un **Environnement
de D√©veloppement** (*IDE* en anglais), et ce, quelque soit le langage que l'on
utilise. Ces derniers int√®grent des tas de fonctionnalit√©s pour vous simplifier
la vie (colorisation du code, diagnostique automatique des erreurs de syntaxe,
outils int√©gr√©s de visualisation, etc.). Il y en a beaucoup. Certains sont
g√©n√©riques (ils supportent de nombreux langages) comme [Visual Studio
Code](https://code.visualstudio.com/) ou sp√©cifique, destin√© √† un seul langage,
comme c'est le cas de [RStudio](https://posit.co/download/rstudio-desktop/) pour
`R`.

## RStudio

Il s'agit de l'IDE le plus utilis√© pour faire du `R`, et de tr√®s tr√®s loin. Il
est *open-source* et fr√©quemment mis √† jour.

### Cr√©ation d'un projet

#### Organiser son dossier de travail {#sec-orga-files}

La premi√®re chose √† faire quand on commence un projet, quelqu'il soit, c'est de
se **cr√©er un espace de travail coh√©rent** ou vous vous retrouverez facilement.
Ce dernier doit √™tre le plus g√©n√©ralisable possible, de telle sorte √† ce que
vous puissiez le r√©employer pour d'autres projets. De cette fa√ßon, vous ne serez
plus jamais perdus dans vos fichiers et vous **gagnerez un temps consid√©rable**.
Pour de l'analyse/traitement de donn√©es, je vous conseil la configuration
suivante :

- üìÅ `./data/`: l√† o√π vous stockerez vos donn√©es
    - üìÅ `./data/src/`: Les donn√©es sources
    - üìÅ `./data/res/`: Les donn√©es cr√©√©es par vos scripts
- üìÅ `./docs/`: l√† o√π vous enregistrerez vos documents words par exemple.
- üìÅ `./figures/`: l√† o√π vous enregistrerez vos graphs, cartes, ect.
- üìÅ `./scripts/`: vos scripts R

Le `./` fait r√©f√©rence √† la **racine** du dossier : le chemin du dossier dans
lequel les dossiers ci-dessus sont enregistr√©s. Cette racine peut √™tre situ√©e o√π
vous le souhaitez sur votre machine.

:::{.callout-important title="Bien nommer ses fichiers"}

Pourquoi est-ce important ?

- Pour ne pas vous demander √† chaque fois pendant trois plombes comment vous
allez √©crire un nom de fichier ou de dossier.
- Encore une fois pour avoir une organisation nickel.
- Pour √©viter de vous retrouver avec des erreurs li√©es √† des espaces ou des
caract√®res sp√©ciaux.

Aussi, je vous conseil d'adopter une **convention d'√©criture**. Il y en a plein,
vous pouvez inventer la v√¥tre tant qu'elle est coh√©rente. Il est notamment
important de proscrire tous les signes diacritiques (√©, √®, √ß, √†, etc.), les
espaces et les signes (/, %, $, etc.). Je vous conseil la convention qui
consiste √† n'√©crire qu'en minuscule, sans caract√®res sp√©ciaux et en repla√ßant les
espaces par des underscores (`_`).

Par exemple :

:::::::::::::: {.columns}
::: {.column width="50%"}
**Bien**
```
td0_introduction_r.R
rendu_20250506_analyse_spatiale.R
graph_epervier.png
```
:::

::: {.column width="50%"}
**Naze**
```
TD 0 Introduction √† R .R
Rendu_2025/05/06_AnalyseSpatiale.R
Graphique √©pervier.png
```
:::
::::::::::::::
:::

#### Cr√©er un projet RStudio

Une fois que vous avez cr√©√© votre espace de travail dans votre explorateur de
fichier, proc√©dez aux op√©rations suivantes pour cr√©er un projet RStudio.

::: {.callout-tip title="Instructions"}
1. Ouvrez RStudio
2. Cr√©ez un nouveau projet : `Fichier` > `Nouveau projet` > `R√©pertoire existant`.
Indiquez le dossier que vous avez cr√©√© pr√©c√©demment.
3. Cr√©ez un nouveau script `R` : `Fichier` > `Nouveau fichier` > `Script R`.
   Enregistrez-le (`ctrl+s`).
:::

### L'interface

![Interface de RStudio](figures/rstud_interface.png){#fig-rstud_inter}

L'interface fonctionne avec des panneaux que l'on peut changer au besoin dans
les pr√©f√©rences du logiciel[^0_rstud_panes]. Par d√©faut, on a l'organisation de la
@fig-rstud_inter.

[^0_rstud_panes]: `Affichage`>`Volet`>`Options de mise en page des volets`

- **A)**:
    - Dans ce panneau, vous avez vos scripts `R`. **C'est ici que vous
    √©crirez.**
- **B)**:
    - `Console`: La console `R`. La m√™me console interactive que quand on ouvre
    `R` sans RStudio.
    - `Terminal`: Le terminal de votre machine. Sous Windows du `???`.
    - `Travaux`: Des *jobs* que vous faites tourner en arri√®re-plan.
- **C)**:
    - `Environnement`: La liste des objets de la session courante.
    - `Historique`: L'historique des commandes introduites dans la console `R`.
    - `Connexions`: Connexions √† des bases de donn√©es externes.
    - `Tutoriel`: tutos
- **D)**:
    - `Fichiers`: Un explorateur de fichier (comme l'explorateur de fichier windows)
    - `Graphiques`: Un espace o√π les graphs seront affich√©s.
    - `Paquets`: Liste de packages, vous pouvez les installer depuis cet
    onglet.
    - `Aide`: Onglet o√π sont affich√©s les documentations des fonctions que vous
    utilisez.
    - `Visualisateur`: Onglet d'affichage des graphs 3D, des pages webs, etc.
    - `Pr√©sentation`: Onglet d√©di√© aux pr√©sentations.

Il existe d'autres panneaux que l'on peut rajouter √† l'interface au besoin. Vous
aurez surtout besoin de la console, de l'environnement, de l'onglet graphique et
aide.

## Les bases de R pour le traitement de donn√©es

:::{.callout-tip title="Organiser son script R"}

Pour ne pas se perdre dans son code et garantir sa reproductibilit√©, il convient
de l'organiser soigneusement.

Un exemple typique de script en analyse de donn√©es est le suivant :

1. Chargement des packages. C'est toujours la premi√®re chose √† faire.
2. √âcriture des constantes (si n√©cessaire)
3. Chargement des donn√©es
4. Pr√©-traitement des donn√©es (nettoyage, merge, etc.)
5. L'analyse que l'on souhaite effectuer (le c≈ìur du script)
6. Analyse des r√©sultats (graphs, r√©sum√©s, etc.)

Pour bien se retrouver dans le script, on peut tirer parti des commentaires et
cr√©er des titres et des sous-titres. Par exemple :

```{r}
################################################################################
# Titre 1 ----
################################################################################
## Sous titre 1.1 --------------------------------------------------------------
# Commentaire classique

### Sous titre 1.1.1 -----------------------------------------------------------
# Commentaire classique

################################################################################
# Titre 2 ----
################################################################################
## Sous titre 2.1 --------------------------------------------------------------
# code etc.
```

Notez que RStudio identifie automatiquement les commentaires suivis d'un minimum
de quatre caract√®res similaire (`-` ou `#`) comme des niveaux de titre. Pour
d√©finir le niveau, il faut ajuster le nombre de `#` avant le titre (`#` h1, `##`
h2, etc.). Pour vous rendre d'une section √† une autre dans votre script, vous
pouvez utiliser le navigateur situ√© en bas √† gauche de l'onglet script.

:::

::: {.callout-note title="Instruction"}

Lisez l'introduction du @sec-structure-data.

:::

### Les variables

::: {.callout-note title="Instruction: variable"}

Lisez la @sec-variables.

1. Cr√©ez des variables de classe diff√©rente

```{r}
#| collapse: true
#| code-fold: true

# Variables num√©riques
a <- 1
b <- 0.6
class(a)

# Variable "character"
c <- "texte"
d <- "Une autre variable"
class(c)
```


2. Essayez d'effectuer des op√©rations math√©matiques entre des variables de
   diff√©rentes classes. Qu'observez-vous ?

```{r}
#| collapse: true
#| code-fold: true
#| error: true

# Op√©rations
a / b
a * b

# On ne peut pas faire d'op√©rations entre une variable num√©rique et une cha√Æne
# de caract√®re
a + c
```

:::

### Les vecteurs

::: {.callout-note title="Instructions : vecteurs"}

Lisez la @sec-vector.

**Vecteur num√©rique :**

1. Effectuer des op√©rations entre deux vecteurs num√©riques de m√™me longeur : que
   constatez-vous ?

```{r}
#| collapse: true
#| code-fold: true

# D√©finition des vecteurs
a <- c(1, 5, 10, 6)
b <- c(2, 2, 3, 4)

# Op√©rations sur les vecteurs
a / b
a * b

# Les op√©rations sont effectu√©es √©l√©ment par √©l√©ments (par-ex. pour a/b : 1/2,
# 5/2, etc.)
```

2. Effectuer des op√©rations entre une variable num√©rique et un vecteur
   num√©rique: que constatez-vous ?

```{r}
#| collapse: true
#| code-fold: true

# Variable num√©rique
s <- 2

# Op√©rations entre la variable et un vecteur
s * a
a / s
s / a

# La variable num√©rique est appliqu√©e √† tous les √©l√©ments du vecteur via
# l'op√©ration choisie (et inversement)
```

3. Calculer des statistiques √©l√©mentaires sur ces vecteurs (*cf.* @sec-stat-quanti).

```{r}
#| collapse: true
#| code-fold: true

mean(a)
median(a)
sd(a)
min(a)
max(a)
```

**Vecteur de cha√Æne de caract√®res :** (aidez vous de la @sec-stat-quali)

```{r}
vector_str <- c("A", "a", "b", "b", "B", "C", "C")
```

1. Quels sont les modalit√©s du vecteur `vector_str` ?

```{r}
#| collapse: true
#| code-fold: true

unique(vector_str)
```

2. Combien y a-t-il de valeurs associ√©es √† chacune de ces modalit√©s ?

```{r}
#| collapse: true
#| code-fold: true

table(vector_str)
```

:::

### Les tableaux de donn√©es : les Data Frames


::: {.callout-note title="Instruction : cr√©ation de Data Frame"}

Lisez la @sec-structure-df.

1. Cr√©ez un DF de √† partir de quatre vecteurs de longueur 5 (2 num√©riques, 2 de
   cha√Æne caract√®res).

```{r}
#| collapse: true
#| code-fold: true

# D√©finition des vecteurs
a <- c(2, 5, 8, 9, 10)
b <- c(0.2, 0.5, 0.8, 0.1, 0.6)
c <- c("A", "B", "C", "D", "E")
d <- c("banane", "pomme", "p√™che", "framboise", "fraise")

# D√©finition du data.frame
df <- data.frame(
  colonne1 = a,
  colonne2 = b,
  colonne3 = c,
  colonne4 = d
)
df
class(df)
```

2. Acc√©dez √† des colonnes et √† des lignes. R√©cup√©rez le nombre de lignes et de
   colonnes

```{r}
#| collapse: true
#| code-fold: true

# Acc√©der √† des colonnes
df$colonne1
df$colonne3

# Acc√©der √† des lignes
df[1, ]
df[2, ]

# Nombre de lignes
nrow(df)

# Nombre de colonnes
ncol(df)
```

:::


::: {.callout-tip title="Les packages"}

Un package est un ensemble de code pr√™t √† l'emploi que vous pouvez charger
dans votre session `R`. Vous pouvez les voir comme des "extensions".

La premi√®re chose √† faire est d'installer le package sur votre machine. Pour
cela, on emploie la fonction de base `install.packages("<le nom du package>")`.
Par exemple :

```{r}
#| eval: false

# Pour installer le package palmerpenguins
install.packages("palmerpenguins")
```

Cette op√©ration t√©l√©charge le package et l'installe sur votre PC. Une fois le
package install√©, il faut le charger dans la session `R` courante. Pour cela, on
emploie la fonction `library(<nom du package>)`.

```{r}
#| eval: false

# On charge palmerpenguins
library(palmerpenguins)
```

Il n'est pas n√©cessaire d'installer le package plusieurs fois, une seule suffit.
En revanche, il vous faudra charger le package √† chaque nouvelle session `R` si
vous voulez l'utiliser.

:::


::: {.callout-note title="Instructions : manipulation de Data Frame"}

Vous apprendrez avec un jeu de donn√©es d'entra√Ænement issu du package
[`palmerpenguins`](https://allisonhorst.github.io/palmerpenguins/)[^package-data].

[^package-data]: Certains packages poss√®dent des donn√©es d'exemple qui sont
t√©l√©charg√©es sur votre PC au moment de l'installation du package. On peut les
charger dans la session `R` courant avec la fonction `data()`.

- Installer et charger le package `palmerpenguins`

```{r}
# Charge un DF nomm√© penguins dans la session courante
data(package = "palmerpenguins")
head(penguins)
```

Commencez par d√©crire bri√®vement le tableau de donn√©es :

- Nombre d'observations
- Nombre de variables (leur type)

```{r}
#| collapse: true
#| code-fold: true

# Nombre de lignes et de colonnes
nrow(penguins)
ncol(penguins)

# Le type des variables (e.g. Factor, num, int, etc.)
str(penguins)
```

Pour les op√©rations suivantes, appuyez-vous sur la @sec-manip-df. Vous vous
appuierez sur le package `dplyr`.

1. **S√©lection des variables : `select()`**

    1. S√©lectionner les variables `island` et `bill_len`.
    2. S√©lectionner uniquement les variables num√©riques.
    3. S√©lectionner toutes les variables qualitatives sauf `island`.

```{r}
#| collapse: true
#| code-fold: true

# install.packages("dplyr") # Installer le package si besoin
# Charge le package dplyr
library(dplyr)

# Exercice 1 ------------------------------------------------------------------
sel_1 <- select(penguins, island, bill_len)
head(sel_1)

# √âquivalent √†
sel_1 <- penguins |>
    select(island, bill_len)

# Exercice 2 ------------------------------------------------------------------
sel_2 <- select(penguins, where(is.numeric))
head(sel_2)

# √âquivalent √†
sel_2 <- penguins |>
    select(where(is.numeric))

# Exercice 3 ------------------------------------------------------------------
sel_3 <- select(penguins, where(is.factor), -island)
head(sel_3)

# √âquivalent √†
sel_3 <- penguins |>
    select(where(is.factor), -island)
```

2. **Filtrer les observations : `filter()`**

    1. Ne conserver que les pingouins Ad√©lie de l'√Æle de Biscoe qui sont des m√¢les.
    2. Pour l'ann√©e 2007, ne conserver que les pingouins dont la masse est
       sup√©rieure √† la moyenne.
    3. Retirez les lignes contenant des valeurs manquantes.

```{r}
#| collapse: true
#| code-fold: true

# Exercice 1 ------------------------------------------------------------------
filt_1 <- filter(penguins, species == "Adelie", island == "Biscoe", sex == "male")
head(filt_1)

# Exercice 2 ------------------------------------------------------------------
filt_2 <- filter(penguins, year == 2007, body_mass > mean(body_mass, na.rm = TRUE))
head(filt_2)

# Exercice 3 ------------------------------------------------------------------
# install.packages("tidyr") # Installer le package si besoin
library(tidyr)
filt_3 <- drop_na(penguins)
head(filt_3)

# √âquivalent √† (en R base) :
filt_3 <- na.omit(penguins)
```

3. **Cr√©er et modifier des variables : `mutate()`**

    1. Convertissez l'unit√© des nageoires '`flipper_len`' en cm.
    2. Cr√©er un indicateur correspondant √† la longueur du bec (`bill_len`) divis√©e
       par sa profondeur (`bill_dep`).

```{r}
#| collapse: true
#| code-fold: true

# Exercice 1 ------------------------------------------------------------------
mut_1 <- mutate(penguins, flipper_len_cm = flipper_len / 10)
head(mut_1)

# Exercice 2 ------------------------------------------------------------------
mut_2 <- mutate(penguins, len_div_dep = bill_len / bill_dep)
head(mut_2)
```


4. **R√©sum√© de DF :** `summarise()/group_by()`

    1. Calculer la m√©diane et l'amplitude de `bill_len`.
    2. Calculer la m√©diane de chaque variable num√©rique.
    3. Calculer la m√©diane de la longueur du bec par esp√®ce.
    3. Calculer la m√©diane de la longueur du bec par esp√®ce et par sexe.

```{r}
#| collapse: true
#| code-fold: true
#| warning: false

# Exercice 1 ------------------------------------------------------------------
# Supprimer les NAs
penguins <- na.omit(penguins)
# Calculer la m√©diane et l'amplitude
suma_1 <- summarise(
    penguins,
    med_bill_len = median(bill_len),
    range_bill_len = range(bill_len)
)
suma_1

# Exercice 2 ------------------------------------------------------------------
suma_2 <- summarise(penguins, across(where(is.numeric), ~mean(.x)))
suma_2

# Exercice 3 ------------------------------------------------------------------
suma_3 <- penguins |>
    group_by(species) |>
    summarise(med_bill_len = median(bill_len))
suma_3

# Exercice 4 ------------------------------------------------------------------
suma_4 <- penguins |>
    group_by(species, sex) |>
    summarise(med_bill_len = median(bill_len))
suma_4
```

5. **Jointure de donn√©es :**

    1. T√©l√©chargez et chargez les donn√©es : (*cf.* @sec-io-df)
        - Donn√©es g√©ographiques : `iris_29.gpkg` (cliquez
        [ici](https://github.com/MiboraMinima/td-analyse-spatiale/raw/refs/heads/main/00_intro_r/data/src/iris_29.gpkg)
        pour t√©l√©charger la donn√©e).
        - Donn√©es INSEE : `iris_brest.csv` (cliquez
        [ici](https://github.com/MiboraMinima/td-analyse-spatiale/raw/refs/heads/main/00_intro_r/data/src/iris_brest.csv)
        pour t√©l√©charger la donn√©e ; vous verrez le fichier `.csv` brut dans le
        navigateur. Enregistrez le sur votre PC √† l'endroit appropri√©).
    2. Joignez la donn√©e spatiale aux donn√©es INSEE (*cf.* @sec-join).
:::

### R√©f√©rences

Cheat sheet :

- [RStudio](https://rstudio.github.io/cheatsheets/rstudio-ide.pdf){target="_blank"}
- [Base R](https://iqss.github.io/dss-workshops/R/Rintro/base-r-cheat-sheet.pdf){target="_blank"}
- [dplyr](https://thinkr.fr/pdf/dplyr-french-cheatsheet.pdf){target="_blank"}


